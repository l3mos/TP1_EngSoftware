<!DOCTYPE html>
<html lang="pt">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Página de Vendas</title>
    <link rel="stylesheet" href="../styles.css">
    <link rel="stylesheet" href="vendas.css">
    <script defer src="vendas.js"></script>
</head>

<body>
    <header>
        <h1>Vendas</h1>
        <nav>
            <ul>
                <li><a href="../gerente/pag_inicial_gerente.html">Início</a></li>
                <li><a href="../produtos/produtos.html">Produtos</a></li>
                <li><a href="../notificacoes/notificacoes.html">Notificações</a></li>
                <li><a href="vendas.html">Vendas</a></li>
                <li><a href="../register/register.html">Cadastrar Funcionário</a></li>
                <li><a href="../login/login.html">Sair</a></li>
            </ul>
        </nav>
    </header>

    <section id="vendas">
        <button id="btnAdicionarVenda">Adicionar Venda</button>
    </section>

    <footer>
        <p class="copyright-text">© 2024 GerCompras. Todos os direitos reservados.</p>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {

            // Adicionar evento de clique ao botão de adicionar venda
            document.getElementById('btnAdicionarVenda').addEventListener('click', () => {
                // Lógica para abrir o pop-up e permitir ao usuário adicionar uma venda
                const nomeItem = prompt("Insira o nome do item:");
                const quantidade = parseInt(prompt("Insira a quantidade vendida:"));

                const request = window.indexedDB.open('produtosDB', 1);

                request.onsuccess = (event) => {
                    const db = event.target.result;
                    const transaction = db.transaction(['produtos'], 'readwrite');
                    const objectStore = transaction.objectStore('produtos');

                    const getRequest = objectStore.getAll();

                    getRequest.onsuccess = (event) => {
                        const produtos = event.target.result;
                        const produto = produtos.find(item => item.nome === nomeItem);

                        if (produto) {
                            produto.quantidade -= quantidade;
                            objectStore.put(produto);
                            console.log(`Venda de ${quantidade} unidades de ${nomeItem} registrada.`);
                        } else {
                            console.error(`O produto ${nomeItem} não foi encontrado.`);
                            alert(`O produto ${nomeItem} não foi encontrado.`);
                        }
                    };

                    getRequest.onerror = (event) => {
                        console.error('Erro ao buscar produtos:', event.target.error);
                    };
                };

                request.onerror = (event) => {
                    console.error('Erro ao abrir o banco de dados:', event.target.error);
                };
            });

        });
    </script>
</body>

</html>